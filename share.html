<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分享你嘅工作 CP 值</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="share.css">
</head>
<body>
    <header>
        <h1><i class="fas fa-briefcase"></i> 工作 CP 值分享</h1>
        <p>你嘅工作 CP 值結果</p>
    </header>
    <div class="container">
        <div class="card result-card">
            <h2><i class="fas fa-trophy"></i> 你嘅工作 CP 值</h2>
            <div class="score-circle" id="score-circle"></div>
            <h3 id="result-text"></h3>
            <p class="result-description">你嘅工作 CP 值同香港平均比較</p>
            <div class="share-buttons">
                <button onclick="shareToWhatsApp()"><i class="fab fa-whatsapp"></i> 分享到 WhatsApp</button>
                <button onclick="shareToFacebook()"><i class="fab fa-facebook"></i> 分享到 Facebook</button>
                <button onclick="copyLink()"><i class="fas fa-link"></i> 複製連結</button>
            </div>
        </div>
        <div class="card" id="user-report">
            <h2><i class="fas fa-user"></i> 我嘅選擇</h2>
        </div>
        <div class="card" id="comparison-report">
            <h2><i class="fas fa-city"></i> 香港平均數據比較</h2>
        </div>
        <div class="card">
            <h2><i class="fas fa-home"></i> 返回主頁</h2>
            <button onclick="window.location.href='index.html'"><i class="fas fa-arrow-left"></i> 返回</button>
        </div>
    </div>
    <script>
        // 香港市場平均數據（同 script.js 一致）
        const hkStats = {
            avgHoursPerDay: 8.7,
            avgStressLevel: 3.2,
            avgAnnualLeave: 10,
            avgCommuteTime: 0.8,
            avgTransportCost: 30
        };

        // 文字映射（同 script.js 一致）
        const workEnvText = { 5: "甲級寫字樓", 4: "普通商業大樓/在家工作", 3: "工業大廈", 2: "工廠" };
        const colleagueEnvText = { 1: "全部都係PK", 2: "好多 Free Rider", 3: "萍水相逢", 4: "開心工作", 5: "Friend 過夾band" };
        const workStressText = { 1: "完全無壓力", 2: "壓力少", 3: "一般壓力", 4: "壓力大", 5: "極大壓力" };
        const careerGrowthText = { 1: "完全無機會", 2: "機會少", 3: "一般機會", 4: "機會多", 5: "極多機會" };
        const toiletCleanlinessText = { 1: "好污糟", 2: "一般污糟", 3: "麻麻地", 4: "乾淨", 5: "超級乾淨" };
        const bossAttitudeText = { 1: "垃圾老細", 2: "好嚴格", 3: "麻麻地", 4: "Okay啦", 5: "非常好" };
        const medicalInsuranceText = { 0: "無", 1: "有" };
        const otCompensationText = { 0: "無", 1: "有" };
        const industryText = { finance: "金融", education: "教育", retail: "零售", it: "資訊科技", government: "政府", others: "其他" };
        const educationText = { 1: "大專", 2: "大學生", 3: "碩士", 4: "博士" };
        const uniTypeText = { 1: "大專", 2: "私大（樹仁/恒大）", 3: "八大", 4: "海歸（外國升學）" };

        // 從 URL 獲取得分同評級
        const urlParams = new URLSearchParams(window.location.search);
        const worth = parseFloat(urlParams.get('worth'));
        const resultText = decodeURIComponent(urlParams.get('result'));

        // 顯示得分同評級
        document.getElementById('score-circle').innerText = worth.toFixed(1);
        document.getElementById('result-text').innerText = resultText;

        // 從 localStorage 獲取報告數據
        const reportData = JSON.parse(localStorage.getItem('reportData'));
        if (reportData) {
            const {
                monthlySalary,
                annualSalary,
                workingDaysPerYear,
                workDaysPerWeek,
                wfhDaysPerWeek,
                hoursPerDay,
                lunchTime,
                commute,
                transportCost,
                annualLeave,
                workEnvScore,
                colleagueEnvScore,
                workStressScore,
                careerGrowthScore,
                toiletCleanlinessScore,
                bossAttitudeScore,
                medicalInsurance,
                otCompensation,
                industry,
                educationScore,
                experience,
                uniTypeScore
            } = reportData;

            // 計算市場平均薪酬
            let experienceRange;
            if (experience <= 2) experienceRange = 0;
            else if (experience <= 5) experienceRange = 3;
            else if (experience <= 10) experienceRange = 6;
            else experienceRange = 11;

            const marketSalary = marketSalaries[industry][educationScore][experienceRange];
            const salaryComparison = annualSalary - marketSalary;
            const comparisonText = salaryComparison > 0 
                ? `高於市場平均 ${Math.abs(salaryComparison).toLocaleString()} HKD`
                : salaryComparison < 0 
                ? `低於市場平均 ${Math.abs(salaryComparison).toLocaleString()} HKD`
                : "等於市場平均";

            // 計算每日淨薪水、時間成本同總成本
            const netSalaryPerDay = annualSalary / workingDaysPerYear;
            const commuteDaysPerWeek = workDaysPerWeek - wfhDaysPerWeek;
            const avgCommuteTime = commute * (commuteDaysPerWeek / workDaysPerWeek);
            const timeCostPerDay = hoursPerDay + lunchTime + 2 * avgCommuteTime;
            const avgTransportCost = transportCost * (commuteDaysPerWeek / workDaysPerWeek);
            const totalCostPerDay = timeCostPerDay + avgTransportCost / 60;

            // 香港平均數據比較
            const hoursComparison = hoursPerDay > hkStats.avgHoursPerDay 
                ? `高於香港平均 (${hkStats.avgHoursPerDay} 小時) ${((hoursPerDay - hkStats.avgHoursPerDay) / hkStats.avgHoursPerDay * 100).toFixed(1)}%`
                : hoursPerDay < hkStats.avgHoursPerDay 
                ? `低於香港平均 (${hkStats.avgHoursPerDay} 小時) ${((hkStats.avgHoursPerDay - hoursPerDay) / hkStats.avgHoursPerDay * 100).toFixed(1)}%`
                : "等於香港平均";

            const minAnnualLeave = experience <= 2 ? 7 : experience <= 4 ? 8 : experience <= 9 ? 10 : 14;
            const leaveComparison = annualLeave > minAnnualLeave 
                ? `高於香港法定標準 (${minAnnualLeave} 天) ${((annualLeave - minAnnualLeave) / minAnnualLeave * 100).toFixed(1)}%`
                : annualLeave < minAnnualLeave 
                ? `低於香港法定標準 (${minAnnualLeave} 天) ${((minAnnualLeave - annualLeave) / minAnnualLeave * 100).toFixed(1)}%`
                : "等於香港法定標準";

            const stressComparison = workStressScore > hkStats.avgStressLevel 
                ? `高於香港平均壓力水平 (${hkStats.avgStressLevel}/5)`
                : workStressScore < hkStats.avgStressLevel 
                ? `低於香港平均壓力水平 (${hkStats.avgStressLevel}/5)`
                : "等於香港平均壓力水平";

            const commuteComparison = commute > hkStats.avgCommuteTime 
                ? `高於香港平均 (${hkStats.avgCommuteTime} 小時) ${((commute - hkStats.avgCommuteTime) / hkStats.avgCommuteTime * 100).toFixed(1)}%`
                : commute < hkStats.avgCommuteTime 
                ? `低於香港平均 (${hkStats.avgCommuteTime} 小時) ${((hkStats.avgCommuteTime - commute) / hkStats.avgCommuteTime * 100).toFixed(1)}%`
                : "等於香港平均";

            const transportCostComparison = avgTransportCost > hkStats.avgTransportCost 
                ? `高於香港平均 (${hkStats.avgTransportCost} HKD) ${((avgTransportCost - hkStats.avgTransportCost) / hkStats.avgTransportCost * 100).toFixed(1)}%`
                : avgTransportCost < hkStats.avgTransportCost 
                ? `低於香港平均 (${hkStats.avgTransportCost} HKD) ${((hkStats.avgTransportCost - avgTransportCost) / hkStats.avgTransportCost * 100).toFixed(1)}%`
                : "等於香港平均";

            // 生成「我嘅選擇」報告
            let userReportHTML = `
                <table>
                    <tr><th><i class="fas fa-money-bill-wave"></i> 稅前月薪（HKD）</th><td>${monthlySalary.toLocaleString()}</td></tr>
                    <tr><th><i class="fas fa-calendar-week"></i> 每週工作天數</th><td>${workDaysPerWeek}</td></tr>
                    <tr><th><i class="fas fa-home"></i> 每週在家工作天數</th><td>${wfhDaysPerWeek}</td></tr>
                    <tr><th><i class="fas fa-clock"></i> 每日工作時數（唔計食飯時間）</th><td>${hoursPerDay}</td></tr>
                    <tr><th><i class="fas fa-utensils"></i> 食飯時間（小時）</th><td>${lunchTime}</td></tr>
                    <tr><th><i class="fas fa-car"></i> 單程通勤時間（小時）</th><td>${commute}</td></tr>
                    <tr><th><i class="fas fa-ticket-alt"></i> 每日車費（HKD）</th><td>${transportCost}</td></tr>
                    <tr><th><i class="fas fa-umbrella-beach"></i> 年假日數（天）</th><td>${annualLeave}</td></tr>
                    <tr><th><i class="fas fa-building"></i> 工作環境</th><td>${workEnvText[workEnvScore]}</td></tr>
                    <tr><th><i class="fas fa-users"></i> 同事環境</th><td>${colleagueEnvText[colleagueEnvScore]}</td></tr>
                    <tr><th><i class="fas fa-exclamation-circle"></i> 工作壓力</th><td>${workStressText[workStressScore]}</td></tr>
                    <tr><th><i class="fas fa-chart-line"></i> 職業發展機會</th><td>${careerGrowthText[careerGrowthScore]}</td></tr>
                    <tr><th><i class="fas fa-toilet"></i> 公司廁所清潔度</th><td>${toiletCleanlinessText[toiletCleanlinessScore]}</td></tr>
                    <tr><th><i class="fas fa-user-tie"></i> 老細態度</th><td>${bossAttitudeText[bossAttitudeScore]}</td></tr>
                    <tr><th><i class="fas fa-heartbeat"></i> 有無醫療保險</th><td>${medicalInsuranceText[medicalInsurance]}</td></tr>
                    <tr><th><i class="fas fa-clock"></i> 有冇OT補水</th><td>${otCompensationText[otCompensation]}</td></tr>
                    <tr><th><i class="fas fa-briefcase"></i> 行業</th><td>${industryText[industry]}</td></tr>
                    <tr><th><i class="fas fa-graduation-cap"></i> 學業水準</th><td>${educationText[educationScore]}</td></tr>
                    <tr><th><i class="fas fa-briefcase"></i> 工作經驗（年）</th><td>${experience}</td></tr>
                    <tr><th><i class="fas fa-university"></i> 大學類型</th><td>${uniTypeText[uniTypeScore]}</td></tr>
                </table>
            `;
            document.getElementById('user-report').innerHTML += userReportHTML;

            // 生成「香港平均數據比較」報告
            let comparisonReportHTML = `
                <table>
                    <tr><th><i class="fas fa-money-bill-wave"></i> 年薪同市場平均比較</th><td>${comparisonText}</td></tr>
                    <tr><th><i class="fas fa-clock"></i> 每日工作時數</th><td>${hoursComparison}</td></tr>
                    <tr><th><i class="fas fa-umbrella-beach"></i> 年假日數</th><td>${leaveComparison}</td></tr>
                    <tr><th><i class="fas fa-exclamation-circle"></i> 工作壓力</th><td>${stressComparison}</td></tr>
                    <tr><th><i class="fas fa-car"></i> 單程通勤時間</th><td>${commuteComparison}</td></tr>
                    <tr><th><i class="fas fa-ticket-alt"></i> 每日車費</th><td>${transportCostComparison}</td></tr>
                </table>
            `;
            document.getElementById('comparison-report').innerHTML += comparisonReportHTML;
        } else {
            document.getElementById('user-report').innerHTML += '<p>無法載入報告數據，請返回主頁重新評測。</p>';
            document.getElementById('comparison-report').innerHTML += '<p>無法載入報告數據，請返回主頁重新評測。</p>';
        }

        // 分享功能
        function shareToWhatsApp() {
            const text = `我嘅工作 CP 值係 ${worth.toFixed(1)} - ${resultText}！快啲試下你嘅工作 CP 值啦！`;
            const url = window.location.href;
            window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text + ' ' + url)}`, '_blank');
        }

        function shareToFacebook() {
            const url = window.location.href;
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`, '_blank');
        }

        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('連結已複製！');
            });
        }
    </script>
</body>
</html>